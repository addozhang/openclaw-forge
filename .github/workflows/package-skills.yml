name: Package and Release Skills

on:
  push:
    tags:
      - 'v*'  # è§¦å‘æ¡ä»¶ï¼šæ¨é€ç‰ˆæœ¬æ ‡ç­¾ (ä¾‹å¦‚ v1.0.0)
  workflow_dispatch:  # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  package-and-release:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'
      
      - name: Install dependencies
        run: |
          pip install PyYAML
      
      - name: Install OpenClaw skill-creator
        run: |
          # ä¸‹è½½ OpenClaw skill-creator æ‰“åŒ…è„šæœ¬å’Œä¾èµ–
          mkdir -p scripts
          curl -o scripts/package_skill.py https://raw.githubusercontent.com/openclaw/openclaw/main/skills/skill-creator/scripts/package_skill.py
          curl -o scripts/quick_validate.py https://raw.githubusercontent.com/openclaw/openclaw/main/skills/skill-creator/scripts/quick_validate.py
          chmod +x scripts/package_skill.py
      
      - name: Package all skills
        run: |
          mkdir -p dist
          for skill_dir in skills/*/; do
            if [ -f "${skill_dir}SKILL.md" ]; then
              echo "Packaging ${skill_dir}..."
              python3 scripts/package_skill.py "${skill_dir}" dist/
            fi
          done
      
      - name: List packaged skills
        run: ls -lh dist/
      
      - name: Create Release
        uses: softprops/action-gh-release@v1
        if: startsWith(github.ref, 'refs/tags/')
        with:
          files: dist/*.skill
          body: |
            ## ğŸ“¦ OpenClaw Skills Release
            
            æ‰“åŒ…çš„æŠ€èƒ½æ–‡ä»¶ï¼š
            
            ### Skills
            - **google-tasks** - Google Tasks API é›†æˆ
            - **research-prep** - æŠ€æœ¯å†™ä½œç ”ç©¶ç´ ææ”¶é›†
            - **task-status** - é•¿æ—¶ä»»åŠ¡çŠ¶æ€æ›´æ–°
            
            ### å®‰è£…æ–¹æ³•
            
            ä¸‹è½½ `.skill` æ–‡ä»¶åï¼Œåœ¨ OpenClaw ä¸­ä½¿ç”¨ï¼š
            
            ```bash
            openclaw skills install <skill-name>.skill
            ```
            
            æˆ–è€…æ‰‹åŠ¨è§£å‹åˆ° workspace çš„ `skills/` ç›®å½•ã€‚
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
